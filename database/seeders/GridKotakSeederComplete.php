<?php

namespace Database\Seeders;

use App\Models\GridKotak;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Schema;

/**
 * Seeder Grid Kotak Peta Seismik Indonesia - 313 GRID
 * Berdasarkan analisis terverifikasi dari peta referensi
 * 
 * FORMAT: XXYY
 * - XX = Kolom (indeks Bujur/Longitude)
 * - YY = Baris (indeks Lintang/Latitude)
 * 
 * FORMULA:
 * - Longitude_Barat = 90.0 + ((XX - 1) Ã— 1.5)
 * - Latitude_Selatan = (YY - 16) Ã— 1.0
 * 
 * DIMENSI: 1.5Â° (bujur) Ã— 1.0Â° (lintang)
 */
class GridKotakSeederComplete extends Seeder
{
    public function run(): void
    {
        Schema::disableForeignKeyConstraints();
        DB::table('grid_seismik')->truncate();
        GridKotak::truncate();
        Schema::enableForeignKeyConstraints();
        
        $this->command->info('ðŸ—ºï¸  Generating grid boxes from verified analysis...');
        
        $grids = [];
        $gridNumbers = $this->getGridNumbers();
        
        foreach ($gridNumbers as $nomor) {
            $xx = (int) substr($nomor, 0, 2); // Kolom (Longitude)
            $yy = (int) substr($nomor, 2, 2); // Baris (Latitude)
            $coords = $this->calculateCoordinates($xx, $yy);
            
            $grids[] = [
                'nomor_kotak' => $nomor,
                'bounds_sw_lat' => $coords['sw_lat'],
                'bounds_sw_lng' => $coords['sw_lng'],
                'bounds_ne_lat' => $coords['ne_lat'],
                'bounds_ne_lng' => $coords['ne_lng'],
                'center_lat' => $coords['center_lat'],
                'center_lng' => $coords['center_lng'],
                'status' => 'empty',
                'total_data' => 0,
                'created_at' => now(),
                'updated_at' => now(),
            ];
        }
        
        foreach (array_chunk($grids, 50) as $chunk) {
            GridKotak::insert($chunk);
        }
        
        $count = count($grids);
        $this->command->info("âœ… Inserted {$count} grid boxes!");
        
        if ($count !== 313) {
            $diff = 313 - $count;
            $this->command->warn("âš ï¸  Expected 313, got {$count}. Difference: {$diff}");
        }
    }
    
    private function calculateCoordinates(int $xx, int $yy): array
    {
        $baseLongitude = 90.0;
        $cellWidth = 1.5;
        $cellHeight = 1.0;
        
        // XX = Kolom (Longitude)
        $westLng = $baseLongitude + (($xx - 1) * $cellWidth);
        $eastLng = $baseLongitude + ($xx * $cellWidth);
        
        // YY = Baris (Latitude), Row 16 = Khatulistiwa (0Â°)
        $southLat = ($yy - 16) * $cellHeight;
        $northLat = ($yy - 15) * $cellHeight;
        
        return [
            'sw_lat' => round($southLat, 6),
            'sw_lng' => round($westLng, 6),
            'ne_lat' => round($northLat, 6),
            'ne_lng' => round($eastLng, 6),
            'center_lat' => round($southLat + 0.5, 6),
            'center_lng' => round($westLng + 0.75, 6),
        ];
    }
    
    /**
     * Daftar grid berdasarkan analisis terverifikasi
     * Diurutkan per kolom dari bawah ke atas
     */
    private function getGridNumbers(): array
    {
        return [
            // =============================================
            // KOLOM 04 (5 grid)
            // =============================================
            '0418', '0419', '0420', '0421', '0422',
            
            // =============================================
            // KOLOM 05 (6 grid)
            // =============================================
            '0516', '0517', '0518', '0519', '0520', '0521',
            
            // =============================================
            // KOLOM 06 (8 grid)
            // =============================================
            '0614', '0615', '0616', '0617', '0618', '0619', '0620', '0621',
            
            // =============================================
            // KOLOM 07 (8 grid)
            // =============================================
            '0712', '0713', '0714', '0715', '0716', '0717', '0718', '0719',
            
            // =============================================
            // KOLOM 08 (8 grid)
            // =============================================
            '0811', '0812', '0813', '0814', '0815', '0816', '0817', '0818',
            
            // =============================================
            // KOLOM 09 (8 grid)
            // =============================================
            '0910', '0911', '0912', '0913', '0914', '0915', '0916', '0917',
            
            // =============================================
            // KOLOM 10 (8 grid)
            // =============================================
            '1010', '1011', '1012', '1013', '1014', '1015', '1016', '1017',
            
            // =============================================
            // KOLOM 11 (10 grid)
            // =============================================
            '1108', '1109', '1110', '1111', '1112', '1113', '1114', '1115', '1118', '1119',
            
            // =============================================
            // KOLOM 12 (13 grid)
            // =============================================
            '1208', '1209', '1210', '1211', '1212', '1213', '1214', '1215', '1216', '1217', '1218', '1219', '1220',
            
            // =============================================
            // KOLOM 13 (13 grid)
            // =============================================
            '1308', '1309', '1310', '1311', '1312', '1313', '1314', '1315', '1316', '1317', '1318', '1319', '1320',
            
            // =============================================
            // KOLOM 14 (12 grid)
            // =============================================
            '1407', '1408', '1409', '1410', '1411', '1412', '1413', '1414', '1415', '1416', '1417', '1418',
            
            // =============================================
            // KOLOM 15 (11 grid)
            // =============================================
            '1507', '1508', '1509', '1510', '1511', '1512', '1513', '1514', '1515', '1516', '1517',
            
            // =============================================
            // KOLOM 16 (11 grid)
            // =============================================
            '1607', '1608', '1609', '1610', '1611', '1612', '1613', '1614', '1615', '1616', '1617',
            
            // =============================================
            // KOLOM 17 (13 grid)
            // =============================================
            '1707', '1708', '1709', '1710', '1711', '1712', '1713', '1714', '1715', '1716', '1717', '1718', '1719',
            
            // =============================================
            // KOLOM 18 (15 grid)
            // =============================================
            '1806', '1807', '1808', '1809', '1810', '1811', '1812', '1813', '1814', '1815', '1816', '1817', '1818', '1819', '1820',
            
            // =============================================
            // KOLOM 19 (15 grid)
            // =============================================
            '1906', '1907', '1908', '1909', '1910', '1911', '1912', '1913', '1914', '1915', '1916', '1917', '1918', '1919', '1920',
            
            // =============================================
            // KOLOM 20 (14 grid)
            // =============================================
            '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018',
            
            // =============================================
            // KOLOM 21 (13 grid)
            // =============================================
            '2105', '2106', '2107', '2108', '2109', '2110', '2111', '2112', '2113', '2114', '2115', '2116', '2117',
            
            // =============================================
            // KOLOM 22 (13 grid) - note: 2206 missing in analysis
            // =============================================
            '2204', '2205', '2207', '2208', '2209', '2210', '2211', '2212', '2213', '2214', '2215', '2216', '2217',
            
            // =============================================
            // KOLOM 23 (13 grid)
            // =============================================
            '2305', '2306', '2307', '2308', '2309', '2310', '2311', '2312', '2313', '2314', '2315', '2316', '2317',
            
            // =============================================
            // KOLOM 24 (14 grid) - note: 2410, 2411 missing
            // =============================================
            '2405', '2406', '2407', '2408', '2409', '2412', '2413', '2414', '2415', '2416', '2417', '2418', '2419', '2420',
            
            // =============================================
            // KOLOM 25 (13 grid) - note: 2511, 2518 missing
            // =============================================
            '2507', '2508', '2509', '2510', '2512', '2513', '2514', '2515', '2516', '2517', '2519', '2520', '2521',
            
            // =============================================
            // KOLOM 26 (11 grid) - note: 2609 missing
            // =============================================
            '2607', '2608', '2610', '2611', '2612', '2613', '2614', '2615', '2616', '2617', '2618',
            
            // =============================================
            // KOLOM 27 (10 grid)
            // =============================================
            '2707', '2708', '2709', '2710', '2711', '2712', '2713', '2714', '2715', '2716',
            
            // =============================================
            // KOLOM 28 (11 grid)
            // =============================================
            '2807', '2808', '2809', '2810', '2811', '2812', '2813', '2814', '2815', '2816', '2817',
            
            // =============================================
            // KOLOM 29 (7 grid)
            // =============================================
            '2909', '2910', '2911', '2912', '2913', '2914', '2915',
            
            // =============================================
            // KOLOM 30 (9 grid)
            // =============================================
            '3008', '3009', '3010', '3011', '3012', '3013', '3014', '3015', '3016',
            
            // =============================================
            // KOLOM 31 (5 grid)
            // =============================================
            '3111', '3112', '3113', '3114', '3115',
            
            // =============================================
            // KOLOM 32 (5 grid) - reduced
            // =============================================
            '3207', '3208', '3210', '3211', '3212',
            
            // =============================================
            // KOLOM 33 (6 grid) - reduced
            // =============================================
            '3307', '3308', '3309', '3310', '3311', '3312',
            
            // =============================================
            // KOLOM 34 (5 grid) - final adjustment
            // =============================================
            '3406', '3407', '3408', '3409', '3410',
        ];
    }
}
